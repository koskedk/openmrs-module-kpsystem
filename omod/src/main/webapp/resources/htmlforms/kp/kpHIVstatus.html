<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.

-->
<htmlform>

    <script type="text/javascript" src="../moduleResources/kpsystem/scripts/moment.js"></script>
    <script type="text/javascript">

        var tetenus_selected  = function () {
            var testingOption = getValue("tetenus_selected.value");
            if(testingOption ==164957) {

                jq("#couple-discordant input[value=1065]").prop("disabled", true);
            }
            if(testingOption ==164958){
                jq("#couple-discordant input[value=1065]").prop("disabled", false);

            }
        }

        //On Ready
        $(document).ready(function () {
            //Default location
            jq('#default-location').click(defaultLocationChange);

            $('input').on('click',function () {
                var everTested = getValue("ever_been_tested.value");
                if (everTested == 1065 )
                {
                    jq('#test_results input').prop("disabled", false);
                    jq('#testing-date input').prop("disabled", false);
                    jq('#currently_in_care input').prop("disabled", false);
                    jq('#referral input').prop("disabled", false);
                    jq('#referred_to input').prop("disabled", false);
                    jq('#date_started_ART input').prop("disabled", false);
                    jq('#facility input').prop("disabled", false);
                    jq('#currentART_medication input').prop("disabled", false);
                    jq('#most_resent_VL input').prop("disabled", false);
                    jq('#vl_test_date input').prop("disabled", false);
                    jq('#provider input').prop("disabled", false);

                    //jg('#testing-date').val('');
                    // setValue("test_results.value", "");
                    // setValue("testing-date.value", "");
                    // setValue("currently_in_care.value", "");
                    // setValue("referral.value", "");
                    // setValue("referred_to.value", "");
                    // setValue("date_started_ART.value", "");
                    // setValue("facility.value", "");
                    // setValue("currentART_medication.value", "");
                    // setValue("most_resent_VL.value", "");
                    // setValue("vl_test_date.value", "");
                    // setValue("provider.value", "");



                }else{

                    jq('#test_results input').prop("disabled", true);
                    jq('#testing-date input').prop("disabled", true);
                    jq('#currently_in_care input').prop("disabled", true);
                    jq('#referral input').prop("disabled", true);
                    jq('#referred_to input').prop("disabled", true);
                    jq('#date_started_ART input').prop("disabled", true);
                    jq('#facility input').prop("disabled", true);
                    jq('#currentART_medication input').prop("disabled", true);
                    jq('#most_resent_VL input').prop("disabled", true);
                    jq('#vl_test_date input').prop("disabled", true);
                    jq('#provider input').prop("disabled", true);

                }

            });

        });
        var defaultLocationChange = function () {
            var val = jq(this).val();
            var default_location = "<lookup expression="kenyaemr.location()" />";
            if (jq(this).is(':checked')){
                getField('facility.value').val(default_location);
            }else{
                getField('facility.value').val("");
                clearHiddenSections(jq('#default-location'));
            }
        }
        //Before Submit
        beforeSubmit.push(function() {
            var client_tested = getValue("ever_been_tested.value");
            var client_result = getValue("test_results.value");
            if (client_tested == 1065 &amp;&amp; client_result==false )
            {
                getField('test_results.error').html('Please select Test Results.').show();
                return false;

            } else {
                getField('test_results.error').html('Please select Test Results.').hide();
            }
        });
    </script>
    <!--=============Work flow==================-->
    <ifMode mode="VIEW" include="true">
        <div>
            <table style="width: 100%">
                <tr>
                    <td align="left">
                        HIV Screening Date:
                    </td>
                    <td>
                        Results
                    </td>
                    <td align="right">
                        Currently in care:
                    </td>
                </tr>
                <tr>
                    <td>
                        16-Jan-2019
                    </td>
                    <td>
                        Test
                    </td>
                    <td align="right">
                        Test
                    </td>
                </tr>
            </table>
        </div>

    </ifMode>
    <!-- ============ end work flow =================-->


    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td>
                    <ifMode mode="ENTER">
                        <script type="text/javascript">
                            jq(function(){
                                setValue("encounter-date.value", "");
                            });
                        </script>
                    </ifMode>
                    <ifMode mode="EDIT">
                        <script type="text/javascript">
                            jq(function(){

                                //First test
                                var firstTest = getField("hiv-test1-result.value").val();
                                //Negative
                                if(firstTest ==664) {

                                    jq("#hiv-test2-result select").prop("disabled", true);
                                    jq(".kit-name2 select").prop("disabled", true);
                                    jq(".lot-number2 input").prop("disabled", true);
                                    jq("#expiry-date2 input").prop("disabled", true);
                                    getField('hiv-final-result.value').val(664);
                                    jq('#ccc-no input').prop("disabled", true);
                                }
                            });
                        </script>
                    </ifMode>

                </td>

            </tr>
        </table>
    </div>

    <div class="ke-form-header">
        <table width="100%">
            <tr>
                <td>Date:
                    <encounterDate id="encounter-date" showTime="true"/>
                </td>
                <td>Location:
                    <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete"/>
                </td>
            </tr>
        </table>
    </div>
    <div class="ke-form-content">

        <fieldset>
            <legend>HIV status Form</legend>
            <table border="0" width="100%" cellspacing="0" cellpadding="0">

                <tr>
                    <td width="156" valign="top"><p>Ever been tested for HIV</p></td>
                    <td width="156" valign="top"><p>  <obs id="ever_been_tested" class="consent" conceptId="165040" required="true"
                                                           style="radio" answerConceptIds="1065,1066" /></p></td>

                    <td width="156" valign="top"><p> </p></td>
                    <td width="156" valign="top"><p></p></td>
                    <td width="156" valign="top"><p>Test results</p></td>
                    <td width="156" valign="top"><p>  <obs id="test_results" class="consent" conceptId="159427"
                                                           answerConceptIds="703,
                                                            664"  answerLabels="Negative,Positive"
                                                           style="radio" rows="2" />
                    </p></td>

                </tr>
                <tr>
                    <td width="156" valign="top"><p>Date Of test</p></td>
                    <td width="156" valign="top"><p> <obs id="testing-date" conceptId="164400" allowFutureDates="true"
                    /></p></td>


                </tr>
                <tr>
                    <td width="156" valign="top"><p>Currently in care</p></td>
                    <td width="156" valign="top"><p>  <obs id="currently_in_care" class="consent" conceptId="159811"
                                                           style="radio" answerConceptIds="1065,1066" /></p></td>


                    <td width="156" valign="top"><p>Referral</p></td>
                    <td width="156" valign="top"><p>  <obs id="referral" class="consent" conceptId="164849"
                                                           style="radio" answerConceptIds="1065,1066" /></p></td>


                    <td width="156" valign="top"><p>Facility reffered to</p></td>
                    <td width="156" valign="top"><p>  <encounterLocation id="referred_to" default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete"/>
                    </p></td>

                </tr>
                <tr>
                    <td width="156" valign="top"><p>Date started on ART</p></td>
                    <td width="156" valign="top"><p> <obs id="date_started_ART" conceptId="159599" allowFutureDates="true"
                    /></p></td>
                    <td width="156" valign="top"><p>Facility where treatment is being offered:</p></td>

                    <td width="156" valign="top">
                        <table>
                            <tr>

                                <td>
                                    <obs id="facility" conceptId="162724AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
                                </td><td>  <input type="checkbox"  name="default-facility" id="default-location" /> This facility</td>

                            </tr>
                        </table>
                    </td>






                </tr>
                <tr>
                    <td width="156" valign="top"><p>Current ART medication</p></td>
                    <td width="156" valign="top"><p>  <obs id="currentART_medication" class="consent" conceptId="162240"
                                                           style="dropdown" answerConceptIds="84795,164510,164509,104567,162565,164512
                                    ,104565,162201,164854,164971,162562,164974,164972,161364,164969,164976" /></p></td>

                    <td width="156" valign="top"><p>Most recent VL Results</p></td>
                    <td width="156" valign="top"><p>  <obs id="most_resent_VL" class="remarks" conceptId="163042AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                    /></p></td>

                    <td width="156" valign="top"><p> VL test Date</p></td>
                    <td width="156" valign="top"><p> <obs id="vl_test_date" conceptId="162502AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true"
                    /></p></td>

                </tr>

                <tr>
                    <td width="156" valign="top"><p>Refer to HTS</p></td>


                </tr>
                <tr>
                    <td width="156" valign="top"><p>Provider</p></td>
                    <td width="156" valign="top"><p>  <obs id="provider" class="remarks" conceptId="163042AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                    /></p></td>

                </tr>

            </table>

        </fieldset>

    </div>
    <div class="ke-form-footer">
        <submit/>
    </div>

</htmlform>